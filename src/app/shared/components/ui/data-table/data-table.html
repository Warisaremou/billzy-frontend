<data-table-header
  [table]="table"
  [filterChanged]="_filterChanged"
  [searchPlaceholder]="searchPlaceholder()"
></data-table-header>
<div class="overflow-hidden border">
  <!-- we defer the loading of the table, because tanstack manipulates the DOM with flexRender which can cause errors during SSR -->
  @defer {
  <div hlmTableContainer>
    <table hlmTable>
      <thead hlmTHead>
        @for (headerGroup of table.getHeaderGroups(); track headerGroup.id) {
        <tr hlmTr>
          @for (header of headerGroup.headers; track header.id) {
          <th hlmTh [attr.colSpan]="header.colSpan">
            @if (!header.isPlaceholder) {
            <ng-container *flexRender="header.column.columnDef.header; props: header.getContext(); let headerText">
              <div [innerHTML]="headerText"></div>
            </ng-container>
            }
          </th>
          }
        </tr>
        }
      </thead>
      <tbody hlmTBody>
        @for (row of table.getRowModel().rows; track row.id) {
        <tr hlmTr [attr.key]="row.id" [attr.data-state]="row.getIsSelected() && 'selected'">
          @for (cell of row.getVisibleCells(); track $index) {
          <td hlmTd>
            <ng-container *flexRender="cell.column.columnDef.cell; props: cell.getContext(); let cell">
              <div [innerHTML]="cell"></div>
            </ng-container>
          </td>
          }
        </tr>
        } @empty {
        <tr hlmTr>
          <td hlmTd class="h-24 text-center" [attr.colspan]="columns().length">
            <ng-content></ng-content>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }
</div>
<data-table-pagination [table]="table"></data-table-pagination>
